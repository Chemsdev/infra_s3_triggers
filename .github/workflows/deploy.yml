name: Deploy S3 Triggers

on:
  push:
    branches:
      - main

jobs:
  deploy-s3-triggers:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ R√©cup√©ration du code
      - name: üì• Checkout du repo
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Setup Python (utile pour compat √©ventuelle ou debug S3)
      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'

      # 3Ô∏è‚É£ Configuration des identifiants AWS
      - name: üîê Configurer les identifiants AWS
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id:     ${{ secrets.ACCESS_KEY_ID_CHEMS }}
          aws-secret-access-key: ${{ secrets.SECRET_ACCESS_KEY_CHEMS }}
          aws-region:            eu-central-1

      # 4Ô∏è‚É£ Installation de Terraform
      - name: üåç Setup Terraform
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: 1.5.7

      # 5Ô∏è‚É£ Initialisation Terraform
      - name: Terraform Init
        run: terraform init

      # 6Ô∏è‚É£ Affichage du plan (s√©curit√©)
      - name: Terraform Plan
        run: terraform plan

      # 7Ô∏è‚É£ Application auto du plan
      - name: Terraform Apply
        env:
          TF_LOG: INFO
        run: terraform apply -auto-approve
